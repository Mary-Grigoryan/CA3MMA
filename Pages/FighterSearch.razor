@page "/fighter-search"
@inject NavigationManager NavigationManager
@inject MMAStatsService StatsService
@using MMAStatsApp.Shared

<EditForm Model="@this" OnValidSubmit="@Search">
    <InputText id="fighterSearch" class="form-control" @bind-Value="searchQuery" />
    <button type="submit" class="btn btn-primary">Search</button>
</EditForm>

@if (!string.IsNullOrEmpty(errorMessage))
{
    <p>@errorMessage</p>
}
else if (searchResults != null && searchResults.Count == 1)
{
    // There is exactly one result, redirect to the fighter details page
    NavigationManager.NavigateTo($"/fighter-details/{searchResults.First().Name}");
}
else if (searchResults != null && searchResults.Count > 1)
{
    // Display a list or grid of fighters matching the search term
    <div class="fighter-grid">
    @foreach (var fighter in searchResults)
        {
            <FighterCard fighter="@fighter" />
        }
    </div>
}

@code {
    private string? searchQuery;
    private List<FighterResult>? searchResults;
    private string? errorMessage; // To display an error message in the UI

    private async Task Search()
    {
        errorMessage = null; // Clear previous error messages

        if (string.IsNullOrWhiteSpace(searchQuery))
        {
            errorMessage = "Please enter a search query.";
            return;
        }

        try
        {
            searchResults = await StatsService.SearchFighters(searchQuery);
            if (searchResults == null || !searchResults.Any())
            {
                errorMessage = "No results found.";
            }
            else if (searchResults.Count == 1)
            {
                // If there is exactly one result, redirect to the fighter details page
                NavigationManager.NavigateTo($"/fighter-details/{searchResults.First().Name}");
            }
            // If there are multiple results, they will be displayed by the markup above
        }
        catch (Exception ex)
        {
            errorMessage = $"An error occurred: {ex.Message}";
        }
    }
}
